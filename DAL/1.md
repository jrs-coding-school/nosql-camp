# Exercise: Adding a `createPerson()` function to the DAL

## Prerequisites

Before you can attempt this exercise you must have successfully completed the [README](https://github.com/jrs-innovation-center/relief-student) instructions for the **Relief Tracker Starter Pack**.  This README provides guidance for installing CouchDB, curl, and the **relief-student** project and dependencies on your local machine.

## Instructions

In this exercise, you will create a function named `createPerson()` within the **/DAL/noSQL.js** javascript file.  The function is responsible for adding a new person document into the **relief-student** database on your local machine. The function will take a data argument and a callback function.

```
function createPerson(data, callback) {...your code here...}
```

The `data` argument is used to pass a person in the form of a JSON document:

```
{
    type: "person",
    firstName: "Steve",
    lastName: "Ananias",
    phone: "843 555-1515",
    email: "stevean@duke.edu"
}
```

Passing in a callback function provides the `createPerson()` function a mechanism to 'call you back' after the database has added the person document into the database (or when an error occurs).

> Where do I put my code? Add your code into your local clone of the **relief-student** repo. Your code should reside within the repo's **/DAL/noSQL.js** javascript file.

- Go ahead and open the **relief-student** folder/project within your code editor, such as Atom.
- Open the **/DAL/noSQL.js** javascript file and inspect the code that has been started for you.
- Within the file, add the beginnings of the function to the file.
- Add the function as a new property to the `dal` object.  Notice that `dal` is exported and thereby provides an interface to any that requires this module.

Before your function adds the data into the **relief-student** database, you must validate the incoming document for bad or missing data. If any validations fail, your function should return a `new Error` via the callback.

Example:

```
if (data.hasOwnProperty('lastName') !== true) {
      return callback(new Error('Missing lastName property within data'));
}
```

- Within your `createPerson()` function, validate the following attributes:
   - `_id` attribute is not permitted.
   - `_rev` attribute is not permitted.
   - `lastName`, `firstName`, `email` are required.

- Within your `createPerson()` function, provide the following attribute values:
   - `_id` attribute value should default with a prefix of `"person_"` and the `email` address.
   - `active` attribute value should default to `true`.
   - `type` attribute value should default to `"person"`.

After adding the document into the database, your code should call the callback and return either the error or the response from the database.

Now it's time to try out your new function by attempting to add people to the database.  The data to add into the database is located within the **relief-student** project's **addPerson.js** file. A separate variable has been provided for each person.  Each variable begins with "personData", for example: `personDataJimmy`.  

- Within **addPerson.js**, call your new `createPerson()` function, passing the data for each `personData` variable.  Here's an example.

   ```
   const dalNoSQL = require('./DAL/noSQL.js');

   // person data. Use to test the createPerson() function within your DAL,
   // Make INDIVIDUAL calls to the createPerson() function within your DAL
   // with each personData variable.
   const personDataJimmy = {
       firstName: "Jimmy",
       lastName: "Martin",
       phone: "404 394-2479",
       email: "JimmyMartinJr@gmail.com",
       type: "person",
       active: true
   };

   dalNoSQL.createPerson(personDataJimmy, function callback (err, response) {
         if (err) return console.log(err);
         if (response) return console.log(response);
   });
   ```

- Save **addPerson.js**.
- Issuing the following command within Terminal/Command Prompt to run the program and add the person into the database.  

   ```
   $ cd relief-student
   $ NODE_ENV=production node addPerson.js
   ```
- Edit **addPerson.js** to add the next person and run the program a second time.  Repeat this until all persons have been added into the database.    

   >  Beware:  Some of the "personData" variables contain missing or invalid data.  Hopefully, your code detects the issues within the data.  If not, adjust your code.  

- After you have confidence in your code, correct the data and add the remaining persons to the database.
- Finally, test your code by running the following command.  Correct any issues the test uncovers.
   ```
   $ NODE_ENV=production node test createPerson
   ```

   [Home](/)   |   [DAL](/DAL)  |  [Next](/DAL/2)
