# Exercise: Adding a `createPerson()` function to the DAL

## Prerequisites

Before you can attempt this exercise you must have successfully completed the [README](https://github.com/jrs-innovation-center/relief-student) instructions for the **Relief Tracker Starter Pack**.  This README provides guidance for installing CouchDB, curl, and the **relief-student** project and dependencies on your local machine.

## Instructions
This exercise is the beginning step in the creation of a data access layer or DAL.

In this exercise, you will create a function named `createPerson()` within the **/DAL/noSQL.js** javascript file.  The function is responsible for adding a new person document into the **relief-student** database on your local machine. The function will take a data argument and a callback function.

```
function createPerson(data, callback) {...your code here...}
```

The `data` argument is used to pass a person in the form of a JSON document:

```
{
    type: "person",
    firstName: "Steve",
    lastName: "Ananias",
    phone: "843 555-1515",
    email: "stevean@duke.edu"
}
```

Passing in a callback function provides `createPerson()` a mechanism to 'call you back' after the database has added the person document into the database (or when an error occurs).

> Where do I put my code? Add your code into your local clone of the **relief-student** repo. Your code should reside within the repo's **/DAL/noSQL.js** javascript file.

- Go ahead and open the **relief-student** folder/project within your code editor, such as Atom.
- Open the **/DAL/noSQL.js** javascript file and inspect the code that has been started for you.
- Within the file, add the beginnings of the function to the file.
- Add the function as a new property to the `dal` object.  Notice that `dal` is exported and thereby provides an interface to any other code that requires this module.

### Validate

Before your function adds the data into the **relief-student** database, you must validate the incoming document for bad or missing data.

- If a property fails validation, return a new `Error()` that includes an error message prefixed with a `400` [HTTP Error code](https://en.wikipedia.org/wiki/List_of_HTTP_status_codes).

Example:

```
if (data.hasOwnProperty('lastName') !== true) {
      return callback(new Error('400Missing lastName property within data'));
}
```
- Within your `createPerson()` function, validate the following attributes:
   - `_id` attribute is not permitted.
   - `_rev` attribute is not permitted.
   - `lastName`, `firstName`, `email` attributes are required.

- Within your `createPerson()` function, provide the following attribute default values:
   - `_id` attribute value should default with a prefix of `"person_"` and the `email` address.
   - `active` attribute value should default to `true`.
   - `type` attribute value should default to `"person"`.

After adding the document into the database, your code should call the callback and return either the error or the response from the database.

### Try it out

Now it's time to try out your new function by attempting to add documents to the database.  

- Create a separate javascript file named **createpersontest.js**.
- Within this file, call your new function, passing the data into the call.  `console.log` the error or the response.
- Save and run the file:

   ```
   $ NODE_ENV=production node createpersontest
   ```

- Repeat until you have 5 persons in the database.

## Test

- Test your code by running the following command.  Correct any issues the test uncovers.
   ```
   $ NODE_ENV=production node test createPerson
   ```

   [Home](/)   |   [DAL](/DAL)  |  [Next](/DAL/2)
